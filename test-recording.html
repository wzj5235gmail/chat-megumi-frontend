<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>录音示例</title>
</head>

<body>
    <h1>录音示例</h1>
    <button id="startRecord">开始录音</button>
    <button id="stopRecord" disabled>停止录音</button>
    <audio id="audioPlayback" controls></audio>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const startRecordButton = document.getElementById("startRecord");
            const stopRecordButton = document.getElementById("stopRecord");
            const audioPlayback = document.getElementById("audioPlayback");

            let mediaRecorder;
            let audioChunks = [];

            // 检查浏览器是否支持录音功能
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                console.log("浏览器支持录音功能");

                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        mediaRecorder = new MediaRecorder(stream);

                        mediaRecorder.ondataavailable = event => {
                            audioChunks.push(event.data);
                        };

                        mediaRecorder.onstop = () => {
                            const audioBlob = new Blob(audioChunks, { 'type': 'audio/wav; codecs=opus' });
                            audioChunks = [];
                            const audioUrl = URL.createObjectURL(audioBlob);
                            audioPlayback.src = audioUrl;
                        };
                    })
                    .catch(error => {
                        console.error("获取音频失败: ", error);
                    });
            } else {
                console.error("浏览器不支持录音功能");
            }

            startRecordButton.addEventListener("click", () => {
                if (mediaRecorder) {
                    mediaRecorder.start();
                    startRecordButton.disabled = true;
                    stopRecordButton.disabled = false;
                    console.log("开始录音");
                }
            });

            stopRecordButton.addEventListener("click", () => {
                if (mediaRecorder) {
                    mediaRecorder.stop();
                    startRecordButton.disabled = false;
                    stopRecordButton.disabled = true;
                    console.log("停止录音");
                }
            });
        });

    </script>
</body>

</html>